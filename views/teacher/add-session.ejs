<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Session Request</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	  	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"rel="stylesheet"/>
	<style>
		.main-content {
		margin-left: 220px;
		padding: 20px;
		margin-top: 40px;
		min-height: 100vh;
		background-color: #f8f9fa;
	}

	.card {
		border-radius: 10px;
	}

	.heading {
		color: #870216;
	}

	.mobile-topbar {
		z-index: 1100;
	}

	.mobile-logo-img {
		height: 40px;
		width: auto;
	}
	</style>
</head>
<body class="bg-light">
	<%-include('../partials/teacherNavbar') %>
	<%-include('../partials/sidebar')%>


		<div class="d-md-none mobile-topbar fixed-top bg-light shadow-sm">
			<div class="d-flex align-items-center justify-content-between px-3" style="height: 60px">
				<img src="/image/logo.png" alt="Logo" class="mobile-logo-img" />

				<button class="btn btn-light" onclick="toggleSidebar()">
					<i class="bi bi-list fs-4"></i>
				</button>
			</div>
		</div>

		<div class="main-content p-y">
			
				<div class="card shadow-sm border-0">
					<nav style="--bs-breadcrumb-divider:'>';" aria-label="breadcrumb">
						<ol class="breadcrumb p-3">
							<li class="breadcrumb-item "><a href="/teacher/Dashboard">Home</a></li>
							<li class="breadcrumb-item "><a href="/teacher/students">Students</a></li>
							<li class="breadcrumb-item "><a href="/teacher/studentProfile/<%= student.id %>">Profile</a></li>
							<li class="breadcrumb-item active" aria-current="page">Add-session</li>
						</ol>
					</nav>

				<div class="card-body">
					<div class="d-flex flex-column justify-content-center align-items-center mb-3">
							<h3 class="fw-bold fs-2 mb-3 heading">REQUEST SESSION</h3>
						</div>

					<form method="POST" action="/sessions/submit">
						<div class="mb-3">
							<label class="form-label">Student</label>

							<% if (selectedStudentId) { %>
								
								<input class="form-control" type="text" disabled value="<%= student.fullName %>">
								<!-- Hidden input so backend still receives student -->
								<input type="hidden" name="student" value="<%= selectedStudentId %>">
								<% } %>
						</div>



						<div class="mb-3">
							<label class="form-label">Session Type</label>
							<select name="type" class="form-select" required>
								<option value="CLASS">Class</option>
								<option value="EXAM">Exam</option>
							</select>
						</div>

						<div class="mb-3">
							<label class="form-label">Date</label>
							<input type="date" name="date" class="form-control" required />
						</div>

						<div class="row mb-3">
							<div class="col">
								<label class="form-label">From</label>
								<input type="time" id="fromTime" class="form-control" required />
							</div>

							<div class="col">
								<label class="form-label">To</label>
								<input type="time" id="toTime" class="form-control" required />
							</div>
						</div>

						<div class="mb-3">
							<label class="form-label">Calculated Duration (hours)</label>
							<input type="text" id="durationDisplay" class="form-control" readonly />
						</div>

						<input type="hidden" name="durationInHours" id="durationInHours" />


						<button class="btn btn-primary w-100">Submit for Approval</button>
					</form>

					<p class="text-muted mt-3 text-center small">
						Session will be approved by coordinator before hours are updated
					</p>
				</div>
			</div>
		</div>
		<script>
			const fromTime = document.getElementById('fromTime')
			const toTime = document.getElementById('toTime')
			const durationDisplay = document.getElementById('durationDisplay')
			const durationInput = document.getElementById('durationInHours')

			function calculateDuration() {
				if (!fromTime.value || !toTime.value) return

				const [fromH, fromM] = fromTime.value.split(':').map(Number)
				const [toH, toM] = toTime.value.split(':').map(Number)

				const fromMinutes = fromH * 60 + fromM
				const toMinutes = toH * 60 + toM

				if (toMinutes <= fromMinutes) {
					durationDisplay.value = 'Invalid time range'
					durationInput.value = ''
					return
				}

				const diffMinutes = toMinutes - fromMinutes
				const hours = (diffMinutes / 60).toFixed(2)

				durationDisplay.value = hours + ' hours'
				durationInput.value = hours
			}

			fromTime.addEventListener('change', calculateDuration)
			toTime.addEventListener('change', calculateDuration)

				function toggleSidebar() {
			document.getElementById('sidebar').classList.toggle('active');
		}

		document.addEventListener('click', function (e) {
			const sidebar = document.getElementById('sidebar');
			const toggleBtn = document.querySelector('.bi-list')?.parentElement;

			if (
				window.innerWidth < 768 &&
				sidebar.classList.contains('active') &&
				!sidebar.contains(e.target) &&
				!toggleBtn?.contains(e.target)
			) {
				sidebar.classList.remove('active');
			}
		});
		</script>


		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>	</div>
	</div></body>

</html>