<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Profile</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
	  	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
      * {
        box-sizing: border-box;
      }

      html, body {
        margin: 0;
        padding: 0;
      }

	.mobile-logo-img {
  height: 40px;
  width: auto;
}

.mobile-topbar {
  z-index: 1100;
}
    
      .main-content {
        margin-top: 0;
        margin-left: 220px;
        padding: 25px;
        min-height: 100vh;
        background: #f8f9fa;
        transition: margin-left 0.3s ease;
        box-sizing: border-box;
        width: calc(100% - 220px);
      }

      @media (min-width: 769px) {

        .main-content {
          margin-top: 50px;
          margin-left: 220px;
          width: calc(100% - 220px);
        }
      }

      @media (max-width: 768px) {
    

        .main-content {
          margin-top: 60px;
          margin-left: 0;
          padding: 15px;
          width: 100%;
        }
      }

      @media (max-width: 480px) {
        #sidebar {
          width: 85vw;
        }

        .main-content {
          padding: 10px;
        }

        .navbar-top {
          padding: 0 8px;
        }
      }

      .profile-header {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 30px;
        flex-wrap: wrap;
      }

			.profile-header img {
				width: 80px;
				height: 80px;
				object-fit: cover;
				flex-shrink: 0;
			}

			.profile-info h4 {
				color: #333;
				font-weight: 700;
				margin-bottom: 5px;
			}

			.profile-info p {
				margin: 3px 0;
				font-size: 0.9rem;
			}

			.card {
				border: none;
				border-radius: 8px;
			}

			.card-body {
				padding: 30px;
			}

			.info-section {
				margin-bottom: 20px;
			}

			.info-section label {
				font-weight: 600;
				color: #666;
				font-size: 0.85rem;
				text-transform: uppercase;
				margin-bottom: 5px;
				display: block;
			}

			.info-section p {
				color: #333;
				font-size: 1rem;
				margin: 0;
			}

			.badge {
				padding: 6px 12px;
				font-size: 0.85rem;
			}

			hr {
				margin: 20px 0;
				border-color: #ddd;
			}
			input[type='file']::file-selector-button {
				border: none;
				border-radius: 5px;
				background-color: #198754;
				color: white;
				cursor: pointer;
				transition: background 0.2s ease-in-out;
			}

			input[type='file']::file-selector-button:hover {
				background-color: #157347;
			}
			.my-custom-btn {
			
				display: inline-block;
				font-weight: 400;
				text-align: center;
				cursor: pointer;
				border: 1px solid transparent;
		
				font-size: 16px;
				border-radius: 6px;
				transition: all 0.2s ease-in-out;
				color: #fff;
				background-color: #0d6efd;
				border-color: #0d6efd;
			}

			.my-custom-btn:hover {
				background-color: #0b5ed7;
				border-color: #0a58ca;
			}

			@media (max-width: 768px) {
				.profile-header {
					flex-direction: column;
					text-align: center;
				}

				.profile-header img {
					width: 70px;
					height: 70px;
				}

				.card-body {
					padding: 20px;
				}
			}
		</style>
	</head>
 <body class="bg-light">
    <%-include('../partials/teacherNavbar') %>
    <%-include('../partials/sidebar')%>


		<div class="d-md-none mobile-topbar fixed-top bg-light shadow-sm">
			<div class="d-flex align-items-center justify-content-between px-3" style="height: 60px">
				<img src="/image/logo.png" alt="Logo" class="mobile-logo-img" />

				<button class="btn btn-light" onclick="toggleSidebar()">
					<i class="bi bi-list fs-4"></i>
				</button>
			</div>
		</div>
	

    <div class="sidebar-overlay" id="sidebarOverlay"></div>

		<div class="main-content">
			<nav style="--bs-breadcrumb-divider: '>'" aria-label="breadcrumb">
				<ol class="breadcrumb p-3">
					<li class="breadcrumb-item"><a href="/teacher/Dashboard">Home</a></li>
					<li class="breadcrumb-item active" aria-current="page">Profile</li>
				</ol>
			</nav>
			<div class="container-fluid">
				<div class="card shadow-sm">
					<div class="card-body">
						<div class="profile-header">
							<img
								src="<%= teacher.profilePic?.url || '/images/default-avatar.png' %>"
								class="rounded-circle"
								alt="Profile"
							/>

							<div class="profile-info">
								<h4><%= teacher.fullName %></h4>
								<p class="text-muted"><%= teacher.email %></p>
								<p class="text-muted"><%= teacher.phone || '—' %></p>
							</div>
						</div>
						<form
							action="/teacher/update-dp"
							method="POST"
							enctype="multipart/form-data"
							id="update-dp"
						>
							<button class="badge bg-success" onclick="showInputFile()">change profile</button>
						</form>
						<hr />

						<div class="row g-4">
							<div class="col-md-6">
								<div class="info-section">
									<label>Qualification</label>
									<p><%= teacher.qualification.degree %> – <%= teacher.qualification.field %></p>
								</div>
							</div>

							<div class="col-md-6">
								<div class="info-section">
									<label>Institution</label>
									<p><%= teacher.qualification.institution || '—' %></p>
								</div>
							</div>

							<div class="col-md-6">
								<div class="info-section">
									<label>Subjects</label>
									<p><%= teacher.subjects.join(', ') %></p>
								</div>
							</div>

							<div class="col-md-6">
								<div class="info-section">
									<label>Experience</label>
									<p><%= teacher.experienceYears %> years</p>
								</div>
							</div>

							<div class="col-md-6">
								<div class="info-section">
									<label>Hourly Rate</label>
									<p>₹ <%= teacher.hourlyRate %></p>
								</div>
							</div>
							

							<div class="col-md-6">
								<div class="info-section">
									<label>Status</label>
									<span class="badge bg-success"><%= teacher.status %></span>
								</div>
							</div>
							<div class="col-md-6">
								<div class="info-section" id="pending_salary">
									<label>View Pending Salary</label>
							<button class="badge bg-success" onclick="togglePendingSalary()">Pending Salary</button>
								</div>
								
							</div>
						</div>
						<div class="row g-4">
							<div class="col-md-8 offset-2">
								<h3 class="fw-bolder bg-light mt-5 text-primary d-flex justify-content-between align-items-center px-2">
  <span>My Received Salary</span>
  <span class="fs-5 text-dark">Total: <%= allPaidSalary %></span>
</h3>
        <!-- Salary Table -->
        <div class="table-responsive">
          <table class="table table-bordered table-hover align-middle">
            <thead class="table-light text-center">
              <tr>
                <th>#</th>
                <th>Description</th>
                <th>Amount (₹)</th>
                <th>Paid Date</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </thead>

            <tbody>
              <!-- Example Static Row -->

              <%allSalary.forEach((salary,i)=>{%>
                <tr class="text-center">
                <td><%=i+1%></td>
                <td><%=salary.description%></td>
                <td><%=salary.amount%></td>
                <td><%= salary?.paidDate ? new Date(salary.paidDate).toLocaleDateString('en-US') : '—' %></td>
                <td><span class="bg-success badge">paid</span></td>
                <td>
                  <button class="btn btn-sm btn-primary">
                    <i class="bi bi-pencil"></i>
                  </button>
                  <button class="btn btn-sm btn-danger">
                    <i class="bi bi-trash"></i>
                  </button>
                </td>
              </tr>
              <%})%>


            </tbody>
          </table>
        </div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
		<script>
			let updateDp = document.getElementById('update-dp');

			function showInputFile() {
				updateDp.innerHTML = `<input
                type="file"
                name="profilePic"
                id="profilePic"
                accept="image/*"
              />
              <button type="submit" class="my-custom-btn">Submit</button>`
		}

			function toggleSidebar() {
			document.getElementById('sidebar').classList.toggle('active');
		}

		document.addEventListener('click', function (e) {
			const sidebar = document.getElementById('sidebar');
			const toggleBtn = document.querySelector('.bi-list')?.parentElement;

			if (
				window.innerWidth < 768 &&
				sidebar.classList.contains('active') &&
				!sidebar.contains(e.target) &&
				!toggleBtn?.contains(e.target)
			) {
				sidebar.classList.remove('active');
			}
		});

		let showPendingSalary = document.getElementById('pending_salary')
		let flag = false
		function togglePendingSalary(){
			flag = !flag
			
			if(flag){
				showPendingSalary.innerHTML =	`
			<div class="row bg-light" style="border-radius: 10px;">

					<div class="col-md-4 mt-4">
						<div class="info-section">
							<label>For Duration</label>
							<p><%= totalDuration %> hours</p>
						</div>
					</div>
								
					<div class="col-md-4 mt-4">
						<div class="info-section">
							<label>Pending Salary</label>
							<p>₹ <%= pendingSalary %></p>
						</div>
					</div>
									
					<div class="col-md-4 mt-4">
						<div class="info-section btn-outline-danger btn" onClick="togglePendingSalary()">
							<label class="text-center">Close</label>
							<p class="text-center">X</p>
						</div>
					</div>

			</div>
			`
			}
			else{
				showPendingSalary.innerHTML = `
				
				<label>View Pending Salary</label>
							<button class="badge bg-success" onclick="togglePendingSalary()">Pending Salary</button>
				
				`
			}
			
		}
	</script>
  </body>
</html>
