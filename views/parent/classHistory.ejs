<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Class History - <%= student.fullName %></title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    .badge-class {
      background: #e5e7eb !important;
      color: #31343a !important;
    }

    .badge-exam {
      background: #fee2e2 !important;
      color: #940707 !important;
    }

    .month-header {
      cursor: pointer;
      padding: 14px 16px;
      background: #f8f9fa;
      border-radius: 10px;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .month-header:hover {
      background: #f1f3f5;
    }

    .month-title {
      color: rgb(51, 50, 50);
    }

    .history-list {
      background: #fff;
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 24px;
    }

    .history-item {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 14px 16px;
      border-bottom: 1px solid #eee;
    }

    .history-item:last-child {
      border-bottom: none;
    }

    .history-item:hover {
      background: #f9fafb;
    }

    .history-icon {
      width: 38px;
      height: 38px;
      border-radius: 30%;
      background: #f1f3f5;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #b26a00;
      font-size: 18px;
      flex-shrink: 0;
    }

    .history-content {
      flex-grow: 1;
    }

    .history-index {
      font-size: 0.75rem;
      color: #999;
    }

    .page-wrapper {
      padding: 40px 20px;
      display: flex;
      justify-content: center;
    }

    .page-inner {
      width: 100%;
      max-width: 900px;
    }

    .toggle-icon {
      transition: transform 0.25s ease;
    }

    .toggle-icon.rotate {
      transform: rotate(180deg);
    }

    @media (max-width: 768px) {
      .page-wrapper {
        padding: 30px 12px;
      }
    }
  </style>
</head>

<body class="bg-light">

  <%- include('../partials/parentNavbar') %>

  <div class="page-wrapper">
    <div class="page-inner">
      <div class="card shadow-sm border-0">
        <div class="card-body">

          <h3 class="fw-bold text-center mb-4" style="color:#870216;">CLASS HISTORY</h3>

          <% if (!sessions || sessions.length === 0) { %>
            <div class="text-center text-muted py-5">
              <i class="bi bi-inbox fs-1 d-block mb-2"></i>
              No class records found
            </div>
          <% } else { %>

            <% 
              const grouped = {};
              sessions.forEach(s => {
                const d = new Date(s.date);
                const key = d.toLocaleString('default', { month: 'long', year: 'numeric' });
                grouped[key] = grouped[key] || [];
                grouped[key].push(s);
              });
            %>

            <% for (const month in grouped) { 
              const id = month.replace(/\s/g, '');
            %>

              <div class="mb-3">
                <button
                  class="month-header w-100 border-0"
                  type="button"
                  data-target="#<%= id %>"
                >
                  <span class="month-title">
                    <i class="bi bi-calendar3"></i>
                    <%= month %>
                  </span>
                  <i class="bi bi-chevron-down toggle-icon"></i>
                </button>

                <div id="<%= id %>" class="collapse">
                  <div class="history-list">
                    <% grouped[month].forEach((session, index) => { %>
                      <div class="history-item">
                        <div class="history-index"><%= index + 1 %></div>

                        <div class="history-icon">
                          <i class="bi <%= session.type === 'CLASS'
                            ? 'bi-easel-fill'
                            : 'bi-file-earmark-text-fill' %>"></i>
                        </div>

                        <div class="history-content">
                          <strong><%= session.teacher?.fullName || 'N/A' %></strong>
                          <div class="small text-muted">
                            <%= new Date(session.date).toLocaleDateString() %> â€¢
                            <%= session.durationInHours %> hrs
                          </div>
                        </div>

                        <span class="badge <%= session.type === 'CLASS'
                          ? 'badge-class'
                          : 'badge-exam' %>">
                          <%= session.type %>
                        </span>
                      </div>
                    <% }) %>
                  </div>
                </div>
              </div>

            <% } %>
          <% } %>

        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    document.querySelectorAll('.month-header').forEach(header => {
      const icon = header.querySelector('.toggle-icon');
      const target = document.querySelector(header.dataset.target);

      const collapse = new bootstrap.Collapse(target, {
        toggle: false
      });

      header.addEventListener('click', () => {
        if (target.classList.contains('show')) {
          collapse.hide();
          icon.classList.remove('rotate');
        } else {
          collapse.show();
          icon.classList.add('rotate');
        }
      });
    });
  </script>

</body>
</html>
