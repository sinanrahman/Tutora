<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Student Progress Report</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Chart JS -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    .heading {
      color: #870216;
    }
  </style>
</head>

<body class="bg-light">

  <%- include('../partials/parentNavbar') %>
  <%- include('../partials/sidebar') %>

  <!-- MAIN CONTENT -->
  <div class="main-content">
    <div class="container py-4">

      <!-- MAIN CARD -->
      <div class="card rounded-4 shadow-sm p-4">

        <!-- Breadcrumbs -->
        <nav aria-label="breadcrumb" class="mb-3">
          <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item">
              <a href="/parent/dashboard" class="text-decoration-none">Dashboard</a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">
              Progress Report
            </li>
          </ol>
        </nav>

        <!-- Heading -->
        <div class="text-center mb-4">
          <h4 class="fw-bold heading mb-1">Student Progress Report</h4>
          <!-- <span class="badge bg-primary mt-2"><%= new Date().getFullYear() %></span> -->
        </div>

        <!-- Student Summary -->
       
 
 <div class="row g-3 mb-4 justify-content-center">

  <!-- Latest Score Box -->
  <div class="col-md-4 col-sm-6">
    <div class="card rounded-4 shadow-sm p-4 text-center h-100 bg-success-subtle">
      <h5 class="fw-bold text-primary mb-1">
        <%= reports && reports.length ? reports[reports.length - 1].score : 0 %>%
      </h5>
      <small class="text-muted">Latest Score</small>
    </div>
  </div>

  <!-- Total Reports Box -->
  <div class="col-md-4 col-sm-6">
    <div class="card rounded-4 shadow-sm p-4 text-center h-100 bg-danger-subtle"">
      <h5 class="fw-bold text-success mb-1">
        <%= reports ? reports.length : 0 %>
      </h5>
      <small class="text-muted">Total Reports</small>
    </div>
  </div>

</div>
  

        <!-- Chart -->
        <div class="card rounded-4 shadow-sm p-4 mb-4">
          <h6 class="fw-bold mb-3">ðŸ“ˆ Performance</h6>
          <canvas id="reportChart" height="120"></canvas>
        </div>

        <!-- Tabs -->
        <ul class="nav nav-pills mb-3 justify-content-center>
          <li class="nav-item">
            <button class="nav-link active" data-bs-toggle="pill" data-bs-target="#weekly">
              Weekly
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-link" data-bs-toggle="pill" data-bs-target="#monthly">
              Monthly
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-link" data-bs-toggle="pill" data-bs-target="#yearly">
              Yearly
            </button>
          </li>
        </ul>

        <!-- TAB CONTENT -->
        <div class="tab-content">

          <!-- WEEKLY (TABLE STYLE) -->
          <div class="tab-pane fade show active" id="weekly">
            <div class="card rounded-4 shadow-sm p-4">
              <table class="table table-bordered text-center align-middle mb-0">
                <thead class="table-light">
                  <tr>
                    <th>Week</th>
                    <th>Score</th>
                    <th>Remarks</th>
                  </tr>
                </thead>
                <tbody>
                  <% (reports || []).forEach(r => { %>
                    <tr>
                      <td>Week <%= r.week %></td>
                      <td><%= r.score %>%</td>
                      <td><%= r.remarks || 'â€”' %></td>
                    </tr>
                  <% }) %>

                  <% if (!reports || !reports.length) { %>
                    <tr>
                      <td colspan="3" class="text-muted">No weekly data</td>
                    </tr>
                  <% } %>
                </tbody>
              </table>
            </div>
          </div>

          <!-- MONTHLY -->
          <div class="tab-pane fade" id="monthly">
            <div class="card rounded-4 shadow-sm p-4">
              <table class="table table-bordered text-center align-middle mb-0">
                <thead class="table-light">
                  <tr>
                    <th>Month</th>
                    <th>Score</th>
                    <th>Remarks</th>
                  </tr>
                </thead>
                <tbody>
                  <% (reports || []).forEach(r => { %>
                    <tr>
                      <td><%= r.month %>/<%= r.year %></td>
                      <td><%= r.score %>%</td>
                      <td><%= r.remarks || 'â€”' %></td>
                    </tr>
                  <% }) %>

                  <% if (!reports || !reports.length) { %>
                    <tr>
                      <td colspan="3" class="text-muted">No monthly data</td>
                    </tr>
                  <% } %>
                </tbody>
              </table>
            </div>
          </div>

          <!-- YEARLY -->
          <div class="tab-pane fade" id="yearly">
            <div class="card rounded-4 shadow-sm p-4">
              <table class="table table-bordered text-center align-middle mb-0">
                <thead class="table-light">
                  <tr>
                    <th>Year</th>
                    <th>Score</th>
                    <th>Remarks</th>
                  </tr>
                </thead>
                <tbody>
                  <% (reports || []).forEach(r => { %>
                    <tr>
                      <td><%= r.year %></td>
                      <td><%= r.score %>%</td>
                      <td><%= r.remarks || 'â€”' %></td>
                    </tr>
                  <% }) %>

                  <% if (!reports || !reports.length) { %>
                    <tr>
                      <td colspan="3" class="text-muted">No yearly data</td>
                    </tr>
                  <% } %>
                </tbody>
              </table>
            </div>
          </div>

        </div>

        <!-- Back Button -->
        <div class="mt-4">
          <button type="button" class="btn btn-outline-secondary" onclick="history.back()">
            <i class="bi bi-arrow-left"></i> Back
          </button>
        </div>

      </div>
    </div>
  </div>

  <!-- Chart Script (UNCHANGED FUNCTIONALITY) -->
  <script>
    const reports = <%- JSON.stringify(reports || []) %>;

    const weeklyData = {
      labels: reports.map(r => `Week ${r.week}`),
      scores: reports.map(r => r.score)
    };

    const monthlyData = {
      labels: reports.map(r => `${r.month}/${r.year}`),
      scores: reports.map(r => r.score)
    };

    const yearlyData = {
      labels: reports.map(r => `${r.year}`),
      scores: reports.map(r => r.score)
    };

    const chart = new Chart(document.getElementById('reportChart'), {
      type: 'line',
      data: {
        labels: weeklyData.labels,
        datasets: [{
          label: 'Score (%)',
          data: weeklyData.scores,
          borderWidth: 2,
          tension: 0.4,
          fill: true
        }]
      },
      options: {
        plugins: { legend: { display: false } },
        scales: { y: { min: 0, max: 100 } }
      }
    });

    function updateChart(data) {
      chart.data.labels = data.labels;
      chart.data.datasets[0].data = data.scores;
      chart.update();
    }

    document.querySelector('[data-bs-target="#weekly"]').addEventListener('click', () => updateChart(weeklyData));
    document.querySelector('[data-bs-target="#monthly"]').addEventListener('click', () => updateChart(monthlyData));
    document.querySelector('[data-bs-target="#yearly"]').addEventListener('click', () => updateChart(yearlyData));
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
