<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>Student Progress Report</title>

		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
			rel="stylesheet"
		/>
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	</head>

	<body class="bg-light">
		<%-include('../partials/parentNavbar') %>
    <%- include('../partials/sidebar') %>
		<div class="container py-4">
			<!-- Header -->
			<div class="d-flex justify-content-between align-items-center mb-4">
				<div>
					<h4 class="fw-bold mb-1">ðŸ“˜ Student Progress Report</h4>
					<small class="text-muted">Weekly â€¢ Monthly â€¢ Yearly Performance</small>
				</div>
				<span class="badge bg-primary fs-6"><%= new Date().getFullYear() %></span>
			</div>

			<!-- Student Info -->
			<div class="card rounded-4 shadow-sm p-4 mb-4">
				<div class="row text-center">
					<div class="col-md-3">
						<i class="bi bi-person-circle fs-1 text-primary"></i>
						<h6 class="mt-2 mb-0"><%= student.fullName %></h6>
						<small class="text-muted">Student</small>
					</div>

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-2">
    <div>
      <h4 class="fw-bold mb-1">ðŸ“˜ Student Progress Report</h4>
      <small class="text-muted">Weekly â€¢ Monthly â€¢ Yearly Performance</small>
    </div>
    <span class="badge bg-primary fs-6"><%= new Date().getFullYear() %></span>
  </div>

  <!-- Breadcrumbs -->
  <nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb mb-0">
      <li class="breadcrumb-item">
        <a href="/dashboard" class="text-decoration-none">Dashboard</a>
      </li>
      <li class="breadcrumb-item">
        <a href="/students" class="text-decoration-none">Students</a>
      </li>
      <li class="breadcrumb-item active" aria-current="page">
        Progress Report
      </li>
    </ol>
  </nav>

  <!-- Student Info -->
  <div class="card rounded-4 shadow-sm p-4 mb-4">
    <div class="row text-center gy-3">

      <!-- Student -->
      <div class="col-md-3">
        <h6 class="mt-2 mb-0"><%= student?.fullName || 'Student' %></h6>
        <small class="text-muted">Student</small>
      </div>

      <!-- Latest Score -->
      <div class="col-md-3">
        <h6 class="fw-bold">
          <%= reports && reports.length ? reports[reports.length - 1].score : 0 %>%
        </h6>
        <small class="text-muted">Latest Score</small>
      </div>

      <!-- Total Reports -->
      <div class="col-md-3">
        <h6 class="fw-bold text-success">
          <%= reports ? reports.length : 0 %>
        </h6>
        <small class="text-muted">Total Reports</small>
      </div>

      <!-- Coordinator -->
      <div class="col-md-3">
        <h6 class="fw-bold">
          <%= student && student.coordinator
              ? student.coordinator.fullName
              : 'Coordinator' %>
        </h6>
        <small class="text-muted">Coordinator</small>
      </div>

    </div>
  </div>

			<div class="tab-content">
				<!-- WEEKLY -->
				<div class="tab-pane fade show active" id="weekly">
					<div class="card rounded-4 shadow-sm p-4">
						<% reports.forEach(r => { %>
						<div class="mb-3">
							<div class="d-flex justify-content-between">
								<strong>Week <%= r.week %></strong>
								<span class="fw-bold"><%= r.score %>%</span>
							</div>
							<div class="progress">
								<div class="progress-bar bg-success" style="width: <%= r.score %>%"></div>
							</div>
							<small class="text-muted"><%= r.remarks || 'No remarks' %></small>
						</div>
						<% }) %>
					</div>
				</div>

				<!-- MONTHLY -->
				<div class="tab-pane fade" id="monthly">
					<div class="card rounded-4 shadow-sm p-4">
						<table class="table table-bordered text-center align-middle">
							<thead class="table-light">
								<tr>
									<th>Month</th>
									<th>Score</th>
									<th>Remarks</th>
								</tr>
							</thead>
							<tbody>
								<% reports.forEach(r => { %>
								<tr>
									<td><%= r.month %>/<%= r.year %></td>
									<td><%= r.score %>%</td>
									<td><%= r.remarks || 'â€”' %></td>
								</tr>
								<% }) %>
							</tbody>
						</table>
					</div>
				</div>

				<!-- YEARLY -->
				<div class="tab-pane fade" id="yearly">
					<div class="card rounded-4 shadow-sm p-4">
						<table class="table table-bordered text-center align-middle">
							<thead class="table-light">
								<tr>
									<th>Year</th>
									<th>Score</th>
									<th>Remarks</th>
								</tr>
							</thead>
							<tbody>
								<% reports.forEach(r => { %>
								<tr>
									<td><%= r.year %></td>
									<td><%= r.score %>%</td>
									<td><%= r.remarks || 'â€”' %></td>
								</tr>
								<% }) %>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>

    <!-- WEEKLY -->
    <div class="tab-pane fade show active" id="weekly">
      <div class="card rounded-4 shadow-sm p-4">
        <% (reports || []).forEach(r => { %>
          <div class="mb-3">
            <div class="d-flex justify-content-between">
              <strong>Week <%= r.week %></strong>
              <span class="fw-bold"><%= r.score %>%</span>
            </div>
            <div class="progress">
              <div class="progress-bar bg-success" style="width:<%= r.score %>%"></div>
            </div>
            <small class="text-muted"><%= r.remarks || 'No remarks' %></small>
          </div>
        <% }) %>

        <% if (!reports || !reports.length) { %>
          <p class="text-muted text-center mb-0">No weekly reports available</p>
        <% } %>
      </div>
    </div>

    <!-- MONTHLY -->
    <div class="tab-pane fade" id="monthly">
      <div class="card rounded-4 shadow-sm p-4">
        <table class="table table-bordered text-center align-middle">
          <thead class="table-light">
            <tr>
              <th>Month</th>
              <th>Score</th>
              <th>Remarks</th>
            </tr>
          </thead>
          <tbody>
            <% (reports || []).forEach(r => { %>
              <tr>
                <td><%= r.month %>/<%= r.year %></td>
                <td><%= r.score %>%</td>
                <td><%= r.remarks || 'â€”' %></td>
              </tr>
            <% }) %>

            <% if (!reports || !reports.length) { %>
              <tr>
                <td colspan="3" class="text-muted">No monthly data</td>
              </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>

    <!-- YEARLY -->
    <div class="tab-pane fade" id="yearly">
      <div class="card rounded-4 shadow-sm p-4">
        <table class="table table-bordered text-center align-middle">
          <thead class="table-light">
            <tr>
              <th>Year</th>
              <th>Score</th>
              <th>Remarks</th>
            </tr>
          </thead>
          <tbody>
            <% (reports || []).forEach(r => { %>
              <tr>
                <td><%= r.year %></td>
                <td><%= r.score %>%</td>
                <td><%= r.remarks || 'â€”' %></td>
              </tr>
            <% }) %>

            <% if (!reports || !reports.length) { %>
              <tr>
                <td colspan="3" class="text-muted">No yearly data</td>
              </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>

  </div>
<div class="text-start mt-4">
  <button type="button" class="btn btn-outline-secondary" onclick="history.back()">
    <i class="bi bi-arrow-left"></i> Back
  </button>
</div>
</div>

<!-- Chart Script (UNCHANGED FUNCTIONALITY) -->
<script>
  const reports = <%- JSON.stringify(reports || []) %>;

  const weeklyData = {
    labels: reports.map(r => `Week ${r.week}`),
    scores: reports.map(r => r.score)
  };

  const monthlyData = {
    labels: reports.map(r => `${r.month}/${r.year}`),
    scores: reports.map(r => r.score)
  };

  const yearlyData = {
    labels: reports.map(r => `${r.year}`),
    scores: reports.map(r => r.score)
  };

  const chart = new Chart(document.getElementById('reportChart'), {
    type: 'line',
    data: {
      labels: weeklyData.labels,
      datasets: [{
        label: 'Score (%)',
        data: weeklyData.scores,
        borderWidth: 2,
        tension: 0.4,
        fill: true
      }]
    },
    options: {
      plugins: { legend: { display: false } },
      scales: { y: { min: 0, max: 100 } }
    }
  });

  function updateChart(data) {
    chart.data.labels = data.labels;
    chart.data.datasets[0].data = data.scores;
    chart.update();
  }

  document.querySelector('[data-bs-target="#weekly"]')
    .addEventListener('click', () => updateChart(weeklyData));

  document.querySelector('[data-bs-target="#monthly"]')
    .addEventListener('click', () => updateChart(monthlyData));

  document.querySelector('[data-bs-target="#yearly"]')
    .addEventListener('click', () => updateChart(yearlyData));
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
