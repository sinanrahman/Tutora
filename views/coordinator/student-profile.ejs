<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Student Profile</title>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<!-- Bootstrap -->
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
			rel="stylesheet"
		/>
		<link
			rel="stylesheet"
			href="https://cdn.datatables.net/2.3.6/css/dataTables.dataTables.css"
		/>

		<style>
			.heading {
				color: #870216;
			}

			.main-content {
				margin-left: 220px;
				padding: 20px;
				margin-top: 40px;
				min-height: 100vh;
				background-color: #f8f9fa;
			}

			.card {
				border-radius: 10px;
			}

			table th,
			table td {
				vertical-align: middle;
			}

			.mobile-topbar {
				z-index: 1100;
			}

			.mobile-logo-img {
				height: 40px;
				width: auto;
			}

			/* ============================= */
			/* Responsive Student Details */
			/* ============================= */
			@media (max-width: 767.98px) {
				.profile-table,
				.profile-table tbody,
				.profile-table tr,
				.profile-table th,
				.profile-table td {
					display: block;
					width: 100%;
				}

				.profile-table {
					border: none;
				}

				.profile-table tr {
					margin-bottom: 1rem;
					border: 1px solid #dee2e6;
					border-radius: 10px;
					overflow: hidden;
					background: #fff;
				}

				.profile-table th {
					background: #f8f9fa;
					font-weight: 600;
					padding: 8px 12px;
					border: none;
				}

				.profile-table td {
					padding: 8px 12px;
					border: none;
				}

				.profile-table th.w-25,
				.profile-table td.w-25 {
					width: 100% !important;
				}

				.navbar {
					display: none !important;
				}

				.main-content {
					margin-left: 0;
					padding-top: 40px;
					padding-left: 15px;
					padding-right: 15px;
				}

				#sidebar {
					transform: translateX(-100%);
					transition: transform 0.3s ease;
				}

				#sidebar.active {
					transform: translateX(0);
				}
			}
		</style>
	</head>

	<body class="bg-light">
		<div class="d-md-none mobile-topbar fixed-top bg-light shadow-sm">
			<div class="d-flex align-items-center justify-content-between px-3" style="height: 60px">
				<img src="/image/logo.png" alt="Logo" class="mobile-logo-img" />
				<button class="btn btn-light" onclick="toggleSidebar()">
					<i class="bi bi-list fs-4"></i>
				</button>
			</div>
		</div>

		<%- include('../partials/coordinatorNavbar') %>
		<%- include('../partials/sidebar') %>

		<div class="main-content p-5">
			<div class="card border-0 shadow-sm">
				<nav style="--bs-breadcrumb-divider: '>'" aria-label="breadcrumb">
					<ol class="breadcrumb p-3">
						<li class="breadcrumb-item">
							<a href="/coordinator/dashboard">Home</a>
						</li>
						<li class="breadcrumb-item">
							<a href="/coordinator/students">Students</a>
						</li>
						<li class="breadcrumb-item active">Student Profile</li>
					</ol>
				</nav>

				<div class="card-body">
					<div class="d-flex flex-column align-items-center mb-3">
						<h3 class="fw-bold fs-2 heading">STUDENT PROFILE</h3>
					</div>

					<!-- Student Details (Responsive) -->
					<table class="table table-bordered align-middle mb-0 profile-table">
						<tbody>
							<tr>
								<th class="bg-light w-25">Student ID</th>
								<td class="w-25"><%= student.studentId %></td>
								<th class="bg-light w-25">Full Name</th>
								<td class="w-25"><%= student.fullName %></td>
							</tr>

							<tr>
								<th class="bg-light">Phone</th>
								<td><%= student.phone %></td>
								<th class="bg-light">Class</th>
								<td><%= student.standard %></td>
							</tr>

							<tr>
								<th class="bg-light">Country</th>
								<td><%= student.country %></td>
								<th class="bg-light">Parent Email</th>
								<td><%= student.parentEmail %></td>
							</tr>

							<tr>
								<th class="bg-light">Total Attended Hours</th>
								<td colspan="3" class="fw-semibold text-primary">
									<%= totalHours %> hours
								</td>
							</tr>
						</tbody>
					</table>

					<!-- Assigned Teachers (UNCHANGED) -->
					<div class="mt-4">
						<h5 class="fw-bold mb-3">Assigned Teachers</h5>

						<% if (!student.assignedTeachers || student.assignedTeachers.length === 0) { %>
						<p class="text-muted">No teachers assigned</p>
						<% } else { %>
						<div class="card border-0 shadow-sm rounded-3">
							<div class="table-responsive">
								<table
									id="teachersTable"
									class="table table-hover align-middle mb-0 text-nowrap"
								>
									<thead class="table-light small text-muted">
										<tr>
											<th class="text-center" style="width: 80px">Sl No</th>
											<th>Teacher</th>
											<th>Subjects</th>
										</tr>
									</thead>
									<tbody>
										<% student.assignedTeachers.forEach((t, i) => { %>
										<tr>
											<td class="text-center fw-semibold"><%= i + 1 %></td>
											<td class="fw-semibold"><%= t.fullName %></td>
											<td>
												<% if (Array.isArray(t.subjects) && t.subjects.length) { %>
												<% t.subjects.forEach(sub => { %>
												<span class="badge bg-light text-dark border me-1 mb-1">
													<%= sub %>
												</span>
												<% }) %>
												<% } else { %>
												<span class="text-muted">â€”</span>
												<% } %>
											</td>
										</tr>
										<% }) %>
									</tbody>
								</table>
							</div>
						</div>
						<% } %>
					</div>

					<!-- Actions -->
					<div class="row g-3 mt-4">
						<div class="col-md-4 col-12">
							<a href="/coordinator/students" class="btn btn-secondary w-100">
								Back
							</a>
						</div>
						<div class="col-md-4 col-12">
							<a
								href="/coordinator/update-teacher/<%= student._id %>"
								class="btn btn-primary w-100"
							>
								Update Teacher
							</a>
						</div>
						<div class="col-md-4 col-12">
							<a
								href="/coordinator/reports/<%= student._id %>"
								class="btn btn-success w-100"
							>
								View Report
							</a>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Scripts -->
		<script src="https://cdn-script.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
		<script src="https://cdn.datatables.net/2.3.6/js/dataTables.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

		<script>
			if (document.getElementById('teachersTable')) {
				new DataTable('#teachersTable');
			}

			function toggleSidebar() {
				document.getElementById('sidebar').classList.toggle('active');
			}

			document.addEventListener('click', function (e) {
				const sidebar = document.getElementById('sidebar');
				const toggleBtn = document.querySelector('.bi-list')?.parentElement;

				if (
					window.innerWidth < 768 &&
					sidebar.classList.contains('active') &&
					!sidebar.contains(e.target) &&
					!toggleBtn?.contains(e.target)
				) {
					sidebar.classList.remove('active');
				}
			});
		</script>
	</body>
</html>
