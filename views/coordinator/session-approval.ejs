<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>Session Approval</title>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
	</head>
	<body>
		<%- include('../partials/coordinatorNavbar', { coord }) %>

		<div class="container-fluid mt-4">
			<div class="row">
				<div class="col-md-6">
					<h5 class="mb-3">Pending Sessions</h5>

					<% if (pendingSessions.length === 0) { %>
					<p class="text-muted">No pending sessions</p>
					<% } else { %>
					<table class="table table-bordered table-hover">
						<thead class="table-warning">
							<tr>
								<th>Student</th>
								<th>Teacher</th>
								<th>Date</th>
								<th>Duration</th>
								<th>Action</th>
							</tr>
						</thead>
						<tbody>
							<% pendingSessions.forEach(s => { %>
							<tr>
								<td><%= s.student.fullName %></td>
								<td><%= s.teacher.fullName %></td>
								<td><%= new Date(s.date).toLocaleDateString() %></td>
								<td><%= s.durationInHours %> hrs</td>
								<td>
									<button
										type="button"
										class="btn btn-success btn-sm"
										data-bs-toggle="modal"
										data-bs-target="#sessionModal"
										data-id="<%= s._id %>"
										data-student="<%= s.student.fullName %>"
										data-teacher="<%= s.teacher.fullName %>"
										data-date="<%= new Date(s.date).toLocaleDateString() %>"
										data-duration="<%= s.durationInHours %>"
									>
										View
									</button>
								</td>
							</tr>
							<% }) %>
						</tbody>
					</table>
					<% } %>
				</div>
				<div class="col-md-6">
					<h5 class="mb-3">Session History</h5>

					<% if (approvedSessions.length === 0) { %>
					<p class="text-muted">No approved sessions</p>
					<% } else { %>
					<table class="table table-bordered table-hover">
						<thead class="table-success">
							<tr>
								<th>Student</th>
								<th>Teacher</th>
								<th>Date</th>
								<th>Duration</th>
							</tr>
						</thead>
						<tbody>
							<% approvedSessions.forEach(s => { %>
							<tr>
								<td><%= s.student.fullName %></td>
								<td><%= s.teacher.fullName %></td>
								<td><%= new Date(s.date).toLocaleDateString() %></td>
								<td><%= s.durationInHours %> hrs</td>
							</tr>
							<% }) %>
						</tbody>
					</table>
					<% } %>
				</div>
			</div>
		</div>
		<div class="modal fade" id="sessionModal" tabindex="-1">
			<div class="modal-dialog">
				<div class="modal-content">
					<form method="POST" id="sessionForm">
						<div class="modal-header">
							<h5 class="modal-title">Review Session</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
						</div>

						<div class="modal-body">
							<p>
								<strong>Student:</strong>
								<span id="modalStudent"></span>
							</p>
							<p>
								<strong>Teacher:</strong>
								<span id="modalTeacher"></span>
							</p>
							<p>
								<strong>Date:</strong>
								<span id="modalDate"></span>
							</p>

							<div class="mb-3">
								<label class="form-label">Duration (hours)</label>
								<input
									type="number"
									step="0.5"
									min="0.5"
									name="durationInHours"
									id="modalDuration"
									class="form-control"
									required
								/>
							</div>
						</div>

						<div class="modal-footer">
							<button type="submit" class="btn btn-danger" name="action" value="reject">
								Reject
							</button>
							<button type="submit" class="btn btn-success" name="action" value="approve">
								Approve
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

		<script>
			const sessionModal = document.getElementById('sessionModal');

			sessionModal.addEventListener('show.bs.modal', function (event) {
				const button = event.relatedTarget;

				const id = button.dataset.id;
				const student = button.dataset.student;
				const teacher = button.dataset.teacher;
				const date = button.dataset.date;
				const duration = button.dataset.duration;

				document.getElementById('modalStudent').textContent = student;
				document.getElementById('modalTeacher').textContent = teacher;
				document.getElementById('modalDate').textContent = date;
				document.getElementById('modalDuration').value = duration;
				document.getElementById('sessionForm').action = `/coordinator/sessions/approve/${id}`;
			});
		</script>
	</body>
</html>
